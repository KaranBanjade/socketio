<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        div {
            width: 40px;
            height: 40px;
            border: black 1px solid;
        }
    </style>
</head>

<body>
    <container>
        <container id="container">
            <span>
                <div id="green" style="background-color: green;"></div>
                <div id="blue" style="background-color: blue;"></div>
                <div id="yellow" style="background-color: yellow;"></div>
                <div id="black" style="background-color: black;" onclick="action(this)"></div>
            </span>
            <span>
                <div id="green" style="background-color: green;"></div>
                <div id="blue" style="background-color: blue;"></div>
                <div id="yellow" style="background-color: yellow;"></div>
                <div id="black" style="background-color: black;" onclick="action(this)"></div>
            </span>
        </container>
    </container>
    <button id="connect">disconnect</button>
    <input type="text" /><button id="room">Join Room</button>
    <input type="text" /><button id="Croom">Create</button>
    <span id="ids">
        <h1>Connected Ids</h1>

    </span>
    <script>

    </script>
    <button id="submit">Submit</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.min.js"></script>
    <script>
        // let arr = ['green', 'blue', 'yellow', 'black', 'green', 'blue', 'yellow', 'black'];
        let arr;
        let r;
        socket = io("http://localhost:3000");
        //Socket Connection setup
        socket.on("connect", () => {
            alert("connected");
            setAction();
            getColor();
        });

        //Message receive
        socket.on('message:receive', (dat) => {
            // alert(dat);
            arr = dat.split(",");
            setColor();
        });

        socket.on('got:users', (dat)=>{
            // alert("hi")
            console.log("hi");
            // console.log(dat);
            // alert(dat);
        });
        socket.on("message:Left", (dat)=>{
            alert(dat, "left");
        });
        document.querySelector("#connect").addEventListener("click", () => {
            socket.emit("disconnect");
            alert("disconnected");
        });

        document.querySelector("#room").addEventListener('click', event => {
            let room = document.querySelector("input").value;
            r = room;
            socket.emit('join:room', room);
            //get all users from room
            // socket.emit('get:users', room);
            alert("joined room");
        })

        document.querySelector("#submit").addEventListener('click', event => {
            // alert("message")
            getColor();

            socket.emit('message:send', arr.toString(), r);
            // socket.emit('message:send', "test,r);
        })

        const setColor = () => {
            document.querySelectorAll("div").forEach((item, key) => {
                item.style.backgroundColor = arr[key];
            })
        }
        const getColor = () => {
            document.querySelectorAll("div").forEach((item, key) => {
                arr[key] = item.style.backgroundColor;
            })
            // alert("get");
        }
        const createDivs = () => {
            document.querySelector("container").innerHTML = `
            <container id="container">
        <span>
            <div id="green" style="background-color: green;"></div>
            <div id="blue" style="background-color: blue;"></div>
            <div id="yellow" style="background-color: yellow;"></div>
            <div id="black" style="background-color: black;" onclick="action(this)"></div>
        </span>
        <span>
            <div id="green" style="background-color: green;"></div>
            <div id="blue" style="background-color: blue;"></div>
            <div id="yellow" style="background-color: yellow;"></div>
            <div id="black" style="background-color: black;" onclick="action(this)"></div>
        </span>
    </container>
            `

            alert("created");
        }
        const setAction = () => {
            document.querySelectorAll('div').forEach(item => {
                item.addEventListener('click', event => {
                    item.style.backgroundColor = 'red';
                    // alert("message")
                    getColor();
                    socket.emit('message:send', arr.toString(), r);
                })
            })
            
            // alert("set action");
        }


    </script>
</body>

</html>